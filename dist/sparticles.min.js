!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i((t=t||self).sparticles={})}(this,(function(t){"use strict";function i(t,i,e){return i in t?Object.defineProperty(t,i,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[i]=e,t}function e(t,i){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);i&&(s=s.filter((function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable}))),e.push.apply(e,s)}return e}var s=function(t){return t*Math.PI/180},n=function(t){return[Math.cos(s(t-90)),Math.sin(s(t-90))]},h=function(t){return.5+t|0},r=function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.max(i,Math.min(e,t))},o=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=i;return(0!==t||1!==i)&&i>t&&(s=Math.random()*(i-t)+t),e&&(s=h(s)),s},a=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:60,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};this.fps=t,this.handler=i;var e=0;this.start=function(){var t=this,i=performance.now(),s=1e3/this.fps;e=requestAnimationFrame((function n(h){var r=h-i;e=requestAnimationFrame(n),r>=s-0&&(t.handler(r),i=h-r%s)}))},this.stop=function(){cancelAnimationFrame(e)}},c=function(t,s,n,h){var r=this;return this.el=t||document.body,this.width=s||200,this.height=n||this.width,this.options=h||{},this.sparticles=[],this.settings=function(t){for(var s=1;s<arguments.length;s++){var n=null!=arguments[s]?arguments[s]:{};s%2?e(n,!0).forEach((function(e){i(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):e(n).forEach((function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))}))}return t}({},{alphaSpeed:10,alphaVariance:1,color:"white",composition:"screen",count:50,direction:180,float:1,imageUrl:null,maxAlpha:1,maxSize:10,minAlpha:0,minSize:1,parallax:1,rotation:1,shape:"circle",speed:10,style:"fill",xVariance:2,yVariance:2},{},this.options),this.setupColors(),this.setupCanvas(),this.setupImage((function(){r.createSparticles(),r.start()})),this};c.prototype.start=function(){var t=this;this.loop||(this.loop=new a(60,(function(i){t.render(i)}))),this.loop.start()},c.prototype.stop=function(){this.loop.stop()},c.prototype.setupColors=function(){var t,i,e;if("rainbow"===this.settings.color){this.settings.color=[];for(var s=0;s<50;s++)this.settings.color[s]=(t=void 0,i=void 0,e=void 0,t=o(0,360,!0),i=o(90,100,!0),e=o(45,85,!0),"hsl(".concat(t,",").concat(i,"%,").concat(e,"%)"))}},c.prototype.setupCanvas=function(){this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.canvas.width=this.width,this.canvas.height=this.height,this.el.appendChild(this.canvas),this.context=this.canvas.getContext("2d")},c.prototype.getImageCanvas=function(t){var i=this.image.width;this.images=this.images||{},this.images[t]=document.createElement("canvas"),this.images[t].width=i,this.images[t].height=i,this.imgCtx=this.images[t].getContext("2d"),this.imgCtx.drawImage(this.image,0,0,i,i,0,0,i,i),this.imgCtx.globalCompositeOperation="source-atop",this.imgCtx.fillStyle=t,this.imgCtx.fillRect(0,0,i,i)},c.prototype.setupImage=function(t){if("image"===this.settings.shape&&this.settings.imageUrl){var i=this;this.images={},this.image=new Image,this.image.onload=function(){Array.isArray(i.settings.color)?i.settings.color.forEach((function(t){i.getImageCanvas(t)})):i.getImageCanvas(i.settings.color),t()},this.image.onerror=function(){console.error("failed to load source image")},this.image.src=this.settings.imageUrl}else t()},c.prototype.createSparticles=function(){this.sparticles=[];for(var t=0;t<this.settings.count;t++)this.sparticles.push(new p(this.canvas,this.settings));return this.sparticles},c.prototype.render=function(t){this.ctx.clearRect(0,0,this.width,this.height);var i=!0,e=!1,s=void 0;try{for(var n,h=this.sparticles[Symbol.iterator]();!(i=(n=h.next()).done);i=!0){n.value.update().render(this.image,this.images)}}catch(t){e=!0,s=t}finally{try{i||null==h.return||h.return()}finally{if(e)throw s}}return this.sparticles};var p=function(t,i){return t&&i?(this.canvas=t,this.ctx=this.canvas.getContext("2d"),this.settings=i,this.init()):console.warn("invalid parameters given to Sparticle",arguments),this};p.prototype.init=function(){var t=this.settings;this.setup(),this.alpha=o(t.minAlpha,t.maxAlpha),this._alpha=this.alpha,this.fillColor=this.getColor(),this.strokeColor=this.getColor(),this.px=o(0,this.canvas.width,!0),this.py=o(0,this.canvas.height,!0),this.rotation=t.rotation?s(o(0,360)):0},p.prototype.setup=function(){var t=this.settings;this.frame=0,this.frameoffset=o(0,360,!0),this.size=o(t.minSize,t.maxSize,!0),this.da=this.getAlpha(),this.dx=this.getDeltaX(),this.dy=this.getDeltaY(),this.df=this.getFloat(),this.dr=this.getRotation()},p.prototype.isOffCanvas=function(){var t=0-4*this.size,i=this.canvas.height+4*this.size,e=this.canvas.width+4*this.size;return this.px<t||this.px>e||this.py<t||this.py>i},p.prototype.reset=function(){this.setup(),this.py<0?this.py=this.canvas.height+2*this.size:this.py>this.canvas.height&&(this.py=0-2*this.size),this.px<0?this.px=this.canvas.width+2*this.size:this.px>this.canvas.width&&(this.px=0-2*this.size)},p.prototype.getColor=function(){return Array.isArray(this.settings.color)?(t=this.settings.color)[Math.floor(o(0,t.length))]:this.settings.color;var t},p.prototype.getAlpha=function(){var t=this.settings.alphaVariance;return o(-t,t)/10},p.prototype.getDeltaX=function(){var t=this.getDelta(),i=this.getDeltaVariance(this.settings.xVariance);return n(this.settings.direction)[0]*t+i},p.prototype.getDeltaY=function(){var t=this.getDelta(),i=this.getDeltaVariance(this.settings.yVariance);return n(this.settings.direction)[1]*t+i},p.prototype.getDeltaVariance=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=this.settings.speed||10;return t>0?o(-t,t)*i/100:0},p.prototype.getDelta=function(){var t=.1*this.settings.speed;return this.settings.speed&&this.settings.parallax?t+this.size*this.settings.parallax/50:t},p.prototype.getFloat=function(){return this.settings.float?o(this.settings.float-this.settings.float/2,this.settings.float+this.settings.float/2):0},p.prototype.getRotation=function(){var t=0;return this.settings.rotation&&(t=s(o(.5,1.5)*this.settings.rotation),.5>o()&&(t=-t)),t},p.prototype.update=function(){return this.frame+=1,this.updateAlpha(),this.updatePosition(),this},p.prototype.updateAlpha=function(){if(this.settings.alphaSpeed>0){var t=this.da/1e3*this.settings.alphaSpeed*10;this._alpha+=t,this.da>0&&this._alpha>this.settings.maxAlpha?(this._alpha=this.settings.maxAlpha,this.da=-this.da):this.da<0&&this._alpha<this.settings.minAlpha&&(this._alpha=this.settings.minAlpha,this.da=-this.da),this.alpha=r(this._alpha,0,1)}},p.prototype.updatePosition=function(){this.px+=this.dx,this.py+=this.dy,this.updateRotate(),this.updateFloat(),this.isOffCanvas()&&this.reset()},p.prototype.updateRotate=function(){this.rotation+=this.dr},p.prototype.updateFloat=function(){this.settings.float&&(this.settings.direction>160&&this.settings.direction<200||this.settings.direction>340&&this.settings.direction<380||this.settings.direction>-20&&this.settings.direction<20?this.px+=n(this.frame+this.frameoffset)[0]*this.df/(15*this.getDelta()):(this.settings.direction>70&&this.settings.direction<110||this.settings.direction>250&&this.settings.direction<290)&&(this.py+=n(this.frame+this.frameoffset)[1]*this.df/(15*this.getDelta())))},p.prototype.render=function(t,i){switch(this.settings.shape){case"image":this.renderImage(t,i);break;case"square":this.renderSquare();break;case"line":this.renderLine();break;case"triangle":this.renderTriangle();break;case"circle":default:this.renderCircle()}return this},p.prototype.renderStyle=function(){this.ctx.globalCompositeOperation=this.settings.composition,this.ctx.globalAlpha=this.alpha,this.ctx.fillStyle=this.fillColor,this.ctx.lineWidth=r(this.size/10,1,5),this.ctx.strokeStyle=this.strokeColor},p.prototype.renderColor=function(){"fill"!==this.settings.style&&"both"!==this.settings.style||this.ctx.fill(),"stroke"!==this.settings.style&&"both"!==this.settings.style||this.ctx.stroke()},p.prototype.renderRotate=function(){if(this.settings.rotation>0){var t=this.px+this.size/2,i=this.py+this.size/2;this.ctx.translate(t,i),this.ctx.rotate(this.rotation),this.ctx.translate(-t,-i)}},p.prototype.renderResetRotate=function(){this.settings.rotation>0&&this.ctx.setTransform(1,0,0,1,0,0)},p.prototype.renderCircle=function(){var t=this.size/2;this.renderStyle(),this.ctx.beginPath(),this.ctx.ellipse(this.px,this.py,t,t,0,0,360),this.renderColor()},p.prototype.renderSquare=function(){this.renderRotate(),this.renderStyle(),this.ctx.beginPath(),this.ctx.rect(this.px,this.py,this.size,this.size),this.renderColor(),this.renderResetRotate()},p.prototype.renderTriangle=function(){var t=this.size,i=this.px+t/2,e=this.py;this.renderRotate(),this.renderStyle(),this.ctx.beginPath(),this.ctx.moveTo(i,e),this.ctx.lineTo(i+t/2,e+t-1),this.ctx.lineTo(i-t/2,e+t-1),this.ctx.closePath(),this.renderColor(),this.renderResetRotate()},p.prototype.renderLine=function(){var t=this.size,i=this.px,e=this.py;this.renderRotate(),this.renderStyle(),this.ctx.beginPath(),this.ctx.moveTo(i,e),this.ctx.lineTo(i+t,e+t),this.ctx.stroke(),this.renderResetRotate()},p.prototype.renderImage=function(t,i){if(t&&t.src){var e=i[this.fillColor],s=e.width,n=this.size/s,h=this.px/n,r=this.py/n;this.renderRotate(),this.ctx.globalCompositeOperation=this.settings.composition,this.ctx.globalAlpha=this.alpha,this.ctx.transform(n,0,0,n,0,0),this.ctx.drawImage(e,0,0,s,s,h,r,s,s),this.ctx.setTransform(1,0,0,1,0,0)}},t.Sparticles=c,Object.defineProperty(t,"__esModule",{value:!0})}));
